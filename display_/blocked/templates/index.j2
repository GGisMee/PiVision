<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SocketIO Cars</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
</head>
<body>
    <canvas id="canvas" width="500" height="500" style="border:1px solid #000;"></canvas>
    <script>
        var socket = io();
        var canvas = document.getElementById("canvas");
        var ctx = canvas.getContext("2d");

        function drawCar(x, y, dx, dy) {
            let angle = Math.atan2(dy, dx);
            let carWidth = 20;
            let carHeight = 40;
            
            ctx.save();
            ctx.translate(x, y);
            
            // Draw car body (black color)
            ctx.fillStyle = "black";
            ctx.fillRect(-carWidth / 2, -carHeight / 2, carWidth, carHeight);
                        
            ctx.restore();
        }

        function drawArrow(x, y, dx, dy) {
            let angle = Math.atan2(dy, dx);
            
            ctx.beginPath();
            ctx.moveTo(x, y);
            ctx.lineTo(x + dx, y + dy);
            ctx.strokeStyle = "red";
            ctx.lineWidth = 2;
            ctx.stroke();

            ctx.beginPath();
            ctx.moveTo(x + dx, y + dy);
            ctx.lineTo(x + dx - 5 * Math.cos(angle - Math.PI / 6), y + dy - 5 * Math.sin(angle - Math.PI / 6));
            ctx.lineTo(x + dx - 5 * Math.cos(angle + Math.PI / 6), y + dy - 5 * Math.sin(angle + Math.PI / 6));
            ctx.lineTo(x + dx, y + dy);
            ctx.fillStyle = "red";
            ctx.fill();
        }

        socket.on("new_points", function(points) {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            points.forEach(({x, y, dx, dy}) => {
                drawCar(x, y, dx, dy);
                drawArrow(x, y, dx, dy);
            });
        });
    </script>
</body>
</html>
